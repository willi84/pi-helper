#!/bin/bash
set -e

if [ "$#" -lt 1 ]; then
    echo "❌ Bitte mindestens ein Paket angeben."
    exit 1
fi

VENV="$HOME/.pi-helper/venv"
TEST=$(python3 -m pip install --dry-run "$1" 2>&1 || true)

if echo "$TEST" | grep -q "externally-managed-environment"; then
    echo "📦 Nutze virtuelle Umgebung ($VENV)..."
    if [ ! -d "$VENV" ]; then
        python3 -m venv "$VENV"
    fi
    "$VENV/bin/pip" install "$@"
else
    echo "📦 Systeminstallation via sudo pip..."
    sudo pip install "$@"
fi
